<%- include("partials/header") %>

<!-- Add Task Form -->
<form action="/add" method="POST" enctype="multipart/form-data" 
  class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8 rounded-2xl bg-white/40 backdrop-blur-lg shadow-2xl border border-white/30 p-6 hover:shadow-indigo-200/40 transition">
  
  <input type="text" name="title" placeholder="Title" required 
    class="col-span-1 md:col-span-3 px-4 py-3 bg-white/50 border border-white/40 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-300 placeholder-gray-500 text-gray-900">

  <input type="text" name="discription" placeholder="Description" required 
    class="col-span-1 md:col-span-3 px-4 py-3 bg-white/50 border border-white/40 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-300 placeholder-gray-500 text-gray-900">

  <input type="date" name="deadline" required 
    class="px-4 py-3 bg-white/50 border border-white/40 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-300 text-gray-900">

  <select name="status" 
    class="px-4 py-3 bg-white/50 border border-white/40 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-300 text-gray-900">
    <option value="">All Status</option>
    <option value="pending" <%= statusFilter === 'pending' ? 'selected' : '' %>>Pending</option>
    <option value="in-progress" <%= statusFilter === 'in-progress' ? 'selected' : '' %>>In Progress</option>
    <option value="completed" <%= statusFilter === 'completed' ? 'selected' : '' %>>Completed</option>
  </select>

  <select name="priority" 
    class="px-4 py-3 bg-white/50 border border-white/40 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-300 text-gray-900">
    <option value="">All Priority</option>
    <option value="low" <%= priorityFilter === 'low' ? 'selected' : '' %>>Low</option>
    <option value="medium" <%= priorityFilter === 'medium' ? 'selected' : '' %>>Medium</option>
    <option value="high" <%= priorityFilter === 'high' ? 'selected' : '' %>>High</option>
  </select>

  <input type="text" name="followup" placeholder="Follow-up Person" required 
    class="px-4 py-3 bg-white/50 border border-white/40 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-300 placeholder-gray-500 text-gray-900">

  <!-- Main Image Upload -->
  <input type="file" name="mainImage" accept="image/*" 
    class="col-span-1 md:col-span-3 px-4 py-3 bg-white/50 border border-white/40 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-300 text-gray-900">

  <button 
    class="col-span-1 md:col-span-3 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl px-4 py-3 shadow-lg font-semibold tracking-wide hover:opacity-90 transition">
    âž• Add Task
  </button>
</form>

<!-- Task Cards -->
<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
  <% if (tasks.length === 0) { %>
    <div class="text-center text-gray-500 col-span-full">No tasks available.</div>
  <% } else { %>
    <% tasks.forEach(task => { %>
      <div class="rounded-2xl bg-white/50 backdrop-blur-lg shadow-xl border border-white/30 p-6 hover:shadow-indigo-200/40 transition transform hover:-translate-y-1 
        <%= task.priority === 'high' ? 'border-red-400/80' : task.priority === 'medium' ? 'border-yellow-400/80' : 'border-green-400/80' %>">
        
        <h2 class="text-xl font-bold mb-2 drop-shadow-sm text-gray-800"><%= task.title %></h2>

        <% if (task.mainImage) { %>
          <img src="/uploads/<%= task.mainImage %>" alt="<%= task.title %> image" 
            class="w-full h-40 object-cover rounded-xl mb-4 shadow-md border border-white/30" />
        <% } %>

        <p class="text-gray-700 mb-2"><%= task.discription %></p>
        <p class="text-sm text-gray-600"><strong>Status:</strong> <%= task.status %></p>
        <p class="text-sm text-gray-600"><strong>Deadline:</strong> <%= task.deadline.toDateString() %></p>
        <p class="text-sm text-gray-600"><strong>Priority:</strong> <%= task.priority %></p>
        <p class="text-sm text-gray-600"><strong>Follow-up:</strong> <%= task.followup %></p>

        <div class="flex justify-between mt-4">
          <form action="/edit/<%= task._id %>" method="get">
            <button class="bg-blue-500/80 hover:bg-blue-600 text-white rounded-lg px-4 py-2 shadow-lg font-semibold text-sm transition">Edit</button>
          </form>
          <form action="/delete/<%= task._id %>" method="POST">
            <button onclick="return confirm('Are you sure to delete?')" 
              class="bg-red-500/80 hover:bg-red-600 text-white rounded-lg px-4 py-2 shadow-lg font-semibold text-sm transition">
              Delete
            </button>
          </form>
        </div>
      </div>
    <% }); %>
  <% } %>
</div>

<!-- Pagination -->
<div class="flex justify-center gap-2 mt-8">
  <% for (let i = 1; i <= totalPages; i++) { %>
    <a 
      href="/?search=<%= searchQuery %>&page=<%= i %>"
      class="px-4 py-2 rounded-full border border-white/40 bg-white/40 backdrop-blur-md text-gray-700 hover:bg-indigo-500 hover:text-white transition 
      <%= i === currentPage ? 'bg-indigo-500 text-white shadow-lg' : '' %>">
      <%= i %>
    </a>
  <% } %>
</div>

<%- include("partials/footer") %>
